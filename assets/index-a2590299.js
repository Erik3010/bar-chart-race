var y=Object.defineProperty;var v=(r,t,e)=>t in r?y(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var s=(r,t,e)=>(v(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function e(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(a){if(a.ep)return;a.ep=!0;const n=e(a);fetch(a.href,n)}})();const D=[{label:"USA",datasets:[{date:"2020",value:267},{date:"2021",value:426},{date:"2022",value:302},{date:"2023",value:432},{date:"2024",value:279}]},{label:"China",datasets:[{date:"2020",value:1883},{date:"2021",value:1340},{date:"2022",value:1748},{date:"2023",value:1838},{date:"2024",value:1271}]},{label:"India",datasets:[{date:"2020",value:1518},{date:"2021",value:1182},{date:"2022",value:1596},{date:"2023",value:1572},{date:"2024",value:1225}]},{label:"Brazil",datasets:[{date:"2020",value:191},{date:"2021",value:243},{date:"2022",value:2e3},{date:"2023",value:2553},{date:"2024",value:1005}]},{label:"Pakistan",datasets:[{date:"2020",value:173},{date:"2021",value:219},{date:"2022",value:187},{date:"2023",value:182},{date:"2024",value:179}]}],P=(r,t)=>{const e=window.devicePixelRatio||1,i=document.createElement("canvas"),a=i.getContext("2d");return i.width=r*e,i.height=t*e,i.style.width=`${r}px`,i.style.height=`${t}px`,a.scale(e,e),i},C=async r=>new Promise(t=>setTimeout(t,r)),B=(r,t,e)=>Math.min(Math.max(r,t),e),T=(()=>{const t=document.createElement("canvas").getContext("2d");return(e,i="16px Arial")=>(t.font=i,t.measureText(e).width)})(),m=r=>new Intl.NumberFormat("en-US").format(r),b=["#084b83","#42bfdd","#ff7700","#ed254e","#f9dc5c","#277AEE","#5b1865","#e01a4f","#81c14b"],L=(r,t,e)=>r+(t-r)*e,I=r=>Math.pow(r,3)*(r*(r*6-15)+10),p=({initialValues:r,targetValues:t,duration:e=100,onUpdate:i})=>new Promise(a=>{const n=performance.now(),h=()=>{const c=(performance.now()-n)/e;if(c>=1)return a(t);const x=I(c),g={};for(const d in r){const w=L(r[d],t[d],x);g[d]=w}i(g),requestAnimationFrame(h)};h()});class A{constructor({ctx:t,x:e,y:i,width:a,height:n,color:h,label:o,value:l}){s(this,"ctx");s(this,"x");s(this,"y");s(this,"width");s(this,"height");s(this,"color");s(this,"label");s(this,"value");s(this,"padding",{top:5,right:0,bottom:5,left:0});s(this,"labelProps",{font:"Arial",fontSize:14,padding:10});s(this,"swapping",!1);this.ctx=t,this.x=e,this.y=i,this.width=a,this.height=n,this.color=h,this.label=o,this.value=l}draw(){this.drawBar(),this.drawLabel({text:this.label,startX:this.x,color:"#000"}),this.drawLabel({text:m(this.value),startX:this.x+this.width,color:"#fff",clampStart:!0})}drawBar(){this.ctx.save(),this.ctx.beginPath(),this.ctx.globalAlpha=.9,this.ctx.fillStyle=this.color,this.ctx.rect(this.x,this.y+this.padding.top,this.width,this.height-this.padding.bottom),this.ctx.fill(),this.ctx.closePath(),this.ctx.restore()}drawLabel({text:t,startX:e,color:i,clampStart:a=!1}){const{font:n,fontSize:h,padding:o}=this.labelProps,l=e-o,c=this.y+(this.height+this.padding.top)/2,x=`${h}px ${n}`,g=T(t,x),d=a?B(l,this.x+o+g,1/0):l;this.ctx.save(),this.ctx.fillStyle=i,this.ctx.font=x,this.ctx.textAlign="right",this.ctx.textBaseline="middle",this.ctx.fillText(t,d,c),this.ctx.restore()}async animateTo(t,e,i){await p({duration:i,initialValues:{width:this.width,value:this.value},targetValues:{width:t,value:e},onUpdate:({width:a,value:n})=>{this.width=a,this.value=Number(n.toFixed(0))}}),this.width=t,this.value=e}async swapBar(t){this.swapping=!0,await p({duration:300,initialValues:{y:this.y},targetValues:{y:t},onUpdate:({y:e})=>this.y=e}),this.y=t,this.swapping=!1}}const u=class u{constructor({ctx:t,start:e,end:i,labels:a}){s(this,"ctx");s(this,"start");s(this,"end");s(this,"labels");s(this,"percentage",0);s(this,"pointerCoordinate",{x:0,y:0});s(this,"strokeColor","#ccc");s(this,"pointerColor","#ababab");s(this,"textColor","#9b9b9b");s(this,"lineOffsetFraction",5);this.ctx=t,this.start=e,this.end=i,this.labels=a,this.updatePointerCoordinate()}set percentageValue(t){this.percentage=t,this.updatePointerCoordinate()}get startX(){return this.start.x+(this.end.x-this.start.x)*this.percentage}updatePointerCoordinate(){this.pointerCoordinate={x:this.startX,y:this.start.y}}calculatePointerCoordinate(){const{POINTER_WIDTH:t,POINTER_OFFSET:e}=u,{x:i,y:a}=this.pointerCoordinate,n=t/2,h=a-e,o=h-t;return{bottomPoint:{x:i,y:h},leftPoint:{x:i-n,y:o},rightPoint:{x:i+n,y:o}}}drawPointer(){const{bottomPoint:t,leftPoint:e,rightPoint:i}=this.calculatePointerCoordinate();this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(e.x,e.y),this.ctx.lineTo(i.x,i.y),this.ctx.fillStyle=this.pointerColor,this.ctx.fill(),this.ctx.closePath()}drawFractionLine(){for(const[t,e]of this.labels.entries()){const i=t/(this.labels.length-1),a=this.start.x+(this.end.x-this.start.x)*i;this.ctx.beginPath(),this.ctx.moveTo(a,this.start.y-this.lineOffsetFraction),this.ctx.lineTo(a,this.start.y+this.lineOffsetFraction),this.ctx.strokeStyle=this.strokeColor,this.ctx.stroke(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.font="12px Arial",this.ctx.textAlign="center",this.ctx.fillStyle=this.textColor,this.ctx.fillText(e,a,this.start.y+22),this.ctx.closePath()}}drawMainBar(){this.ctx.beginPath(),this.ctx.moveTo(this.start.x,this.start.y),this.ctx.lineTo(this.end.x,this.end.y),this.ctx.strokeStyle=this.strokeColor,this.ctx.stroke(),this.ctx.closePath()}draw(){this.drawMainBar(),this.drawFractionLine(),this.drawPointer()}async animateTo(t){const e=100/(this.labels.length-1),i=t*e/100;await p({duration:2500,initialValues:{percentage:this.percentage},targetValues:{percentage:i},onUpdate:({percentage:a})=>this.percentageValue=a}),this.percentage=i}};s(u,"POINTER_WIDTH",10),s(u,"POINTER_OFFSET",8);let f=u;class O{constructor({element:t,data:e,width:i,height:a}){s(this,"containerElement");s(this,"canvas");s(this,"ctx");s(this,"width");s(this,"height");s(this,"data");s(this,"dateIndex",-1);s(this,"padding");s(this,"bars");s(this,"timelineBar");this.containerElement=t,this.data=e,this.width=i,this.height=a,this.canvas=P(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.padding={top:30,right:30,bottom:60,left:100},this.bars=[]}getDataByDate(t){return this.data.map(({label:e,datasets:i})=>{var a;return{label:e,value:((a=i.find(n=>n.date===t))==null?void 0:a.value)??0}})}getLargestDataByDate(t){const e=this.getDataByDate(t);return e.reduce((i,a)=>i.value>a.value?i:a,e[0])}get dateLabels(){return this.data.length===0?[]:this.data[0].datasets.map(t=>t.date)}get currentDate(){return this.dateIndex<0?null:this.dateLabels[this.dateIndex]}get currentData(){return this.getDataByDate(this.currentDate)}get largestCurrentData(){return this.getLargestDataByDate(this.currentDate)}get nextDate(){const t=this.dateIndex+1;return t>=this.dateLabels.length?null:this.dateLabels[t]}get nextData(){return this.nextDate?this.getDataByDate(this.nextDate):null}get largestNextData(){return this.nextDate?this.getLargestDataByDate(this.nextDate):null}get lastDate(){return this.dateLabels[this.dateLabels.length-1]}get chartDimension(){return{x:this.padding.left,y:this.padding.top,width:this.width-this.padding.left-this.padding.right,height:this.height-this.padding.top-this.padding.bottom}}get barHeight(){return this.chartDimension.height/this.data.length}get isInitialAnimation(){return this.dateIndex===-1}init(){this.containerElement.appendChild(this.canvas),this.initBars(),this.initTimelineBar(),this.render(),this.startAnimation()}async startAnimation(){for(;this.nextDate;){const t=this.bars.map(i=>{var l;const a=(l=this.nextData)==null?void 0:l.find(c=>c.label===i.label),n=Math.max(this.largestNextData.value,1),h=a.value/n,o=this.chartDimension.width*h;return i.animateTo(o,a.value,this.isInitialAnimation?1500:2500)}),e=this.isInitialAnimation?[]:[this.timelineBar.animateTo(this.dateIndex+1)];await Promise.all([...t,...e]),await C(100),this.dateIndex++}}sortBarChart(){for(let t=0;t<this.bars.length;t++){const e=this.bars[t],i=this.bars[t-1];i&&!e.swapping&&!i.swapping&&e.value>i.value&&(e.swapBar(i.y),i.swapBar(e.y),this.bars[t]=i,this.bars[t-1]=e)}}initBars(){const t=this.currentData;for(const[e,i]of t.entries()){const a=this.createBar(i,e);this.bars.push(a)}}initTimelineBar(){const e=this.height-this.padding.bottom+25;this.timelineBar=new f({ctx:this.ctx,start:{x:this.padding.left,y:e},end:{x:this.width-this.padding.right,y:e},labels:this.dateLabels})}createBar(t,e){const{x:i,y:a,width:n}=this.chartDimension,h=Math.max(this.largestCurrentData.value,1),o=t.value/h,l=n*o,c=a+e*this.barHeight;return new A({ctx:this.ctx,x:i,y:c,width:l,height:this.barHeight,color:b[e%b.length],label:t.label,value:t.value})}drawLabels(){if(this.isInitialAnimation)return;const t=this.bars.reduce((n,h)=>n+h.value,0),e=this.width-this.padding.right,i=this.height-this.padding.bottom,a=32;this.drawCounterLabel({text:this.currentDate||"",font:"bold 64px Arial",x:e,y:i-a,color:"#ccc"}),this.drawCounterLabel({text:`Total: ${m(t)}`,font:"24px Arial",x:e,y:i,color:"#ccc"})}drawCounterLabel(t){const{text:e,font:i,x:a,y:n,color:h}=t;this.ctx.save(),this.ctx.fillStyle=h,this.ctx.font=i,this.ctx.textAlign="right",this.ctx.fillText(e,a,n),this.ctx.restore()}draw(){this.sortBarChart(),this.drawLabels();for(const t of this.bars)t.draw();this.timelineBar.draw()}render(){this.ctx.clearRect(0,0,this.width,this.height),this.draw(),requestAnimationFrame(this.render.bind(this))}}const S=new O({data:D,element:document.querySelector("#app"),width:800,height:400});S.init();
